function u(e){let t=e.replace(/-----BEGIN PRIVATE KEY-----/,"").replace(/-----END PRIVATE KEY-----/,"").replace(/\n/g,"").trim(),r=atob(t),i=new Uint8Array(r.length);for(let n=0;n<r.length;n++)i[n]=r.charCodeAt(n);return i.buffer}async function m(e,t,r){let i={alg:"RS256",typ:"JWT"},n=Math.floor(Date.now()/1000),o={iss:e,scope:r,aud:"https://oauth2.googleapis.com/token",exp:n+3600,iat:n},s=(y)=>btoa(JSON.stringify(y)).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_"),a=new TextEncoder,h=u(t),d=await crypto.subtle.importKey("pkcs8",h,{name:"RSASSA-PKCS1-v1_5",hash:"SHA-256"},!1,["sign"]),p=`${s(i)}.${s(o)}`,f=await crypto.subtle.sign("RSASSA-PKCS1-v1_5",d,a.encode(p)),w=btoa(String.fromCharCode(...new Uint8Array(f))).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_");return`${p}.${w}`}async function c(e,t,r){let i=await m(e,t,r),o=await(await fetch("https://oauth2.googleapis.com/token",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({assertion:i,grant_type:"urn:ietf:params:oauth:grant-type:jwt-bearer"})})).json();if(o&&typeof o.access_token=="string")return o.access_token;return}class g{parentFolder="";credential={};storage={};constructor(e,t){this.credential=e,this.parentFolder=t}async getToken(){let e=Date.now();if(this.storage.token&&e<this.storage.expireAt)return this.storage.token;return this.storage.token=await c(this.credential.client_email,this.credential.private_key,"https://www.googleapis.com/auth/drive"),this.storage.expireAt=e+3600000,this.storage.token}async create(e){let t=new FormData;t.append("metadata",new Blob([JSON.stringify({name:e.name,mimeType:e.type,parents:this.parentFolder})],{type:"application/json"})),t.append("file",e);let r=await this.getToken(),i=await fetch("https://www.googleapis.com/upload/drive/v3/files?uploadType=multipart",{body:t,method:"POST",headers:{Authorization:`Bearer ${r}`}}),{id:n}=await i.json();return n}async remove(e){let t=await this.getToken();try{return await fetch(`https://www.googleapis.com/drive/v3/files/${e}`,{method:"DELETE",headers:{Authorization:`Bearer ${t}`}}),!0}catch{return!1}}async filter(){let e=await this.getToken();try{let r=await(await fetch("https://www.googleapis.com/drive/v3/files?q='me' in owners&fields=files(id, name)",{method:"GET",headers:{Authorization:`Bearer ${e}`}})).json();if(r&&Array.isArray(r.files))return r.files;return}catch{return}}}class l{databaseURL;credential;accessToken=null;tokenExpiry=0;constructor(e,t){this.credential=e,this.databaseURL=t}async getToken(){let e=Date.now();if(this.accessToken&&e<this.tokenExpiry)return this.accessToken;return this.accessToken=await c(this.credential.client_email,this.credential.private_key,"https://www.googleapis.com/auth/firebase.database"),this.tokenExpiry=e+3600000,this.accessToken}async findAll(e){let t=await this.getToken(),r=await fetch(`${this.databaseURL}/${e}.json`,{headers:{Authorization:`Bearer ${t}`}});return r.ok?await r.json():null}async create(e,t){let r=await this.getToken();return(await fetch(`${this.databaseURL}/${e}.json`,{method:"PUT",headers:{Authorization:`Bearer ${r}`,"Content-Type":"application/json"},body:JSON.stringify(t)})).ok?t:null}async remove(e){let t=await this.getToken();return(await fetch(`${this.databaseURL}/${e}.json`,{method:"DELETE",headers:{Authorization:`Bearer ${t}`}})).ok}async query(e,t){let r=await this.getToken(),i=new URLSearchParams(t).toString(),n=await fetch(`${this.databaseURL}/${e}.json?${i}`,{headers:{Authorization:`Bearer ${r}`}});return n.ok?await n.json():null}async transaction(e,t){try{let r=await this.getToken(),i=`${this.databaseURL}/${e}.json`,n=await fetch(i,{method:"GET",headers:{Authorization:`Bearer ${r}`}});if(!n.ok)throw new Error(`Error fetching data: ${n.statusText}`);let o=await n.json(),s=t(o),a=await fetch(i,{method:"PUT",headers:{Authorization:`Bearer ${r}`,"Content-Type":"application/json"},body:JSON.stringify(s)});if(!a.ok)throw new Error(`Error updating data: ${a.statusText}`);return await a.json()}catch(r){return console.error("Transaction failed:",r),null}}}class A{credential={};constructor(e){this.credential=e}drive(e){return new g(this.credential,e)}database(e){return new l(this.credential,e)}}export{A as GoogleAuth};
